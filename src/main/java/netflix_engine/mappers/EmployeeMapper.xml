<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="netflix_engine.mappers.EmployeeMapper">


    <resultMap id="employeeResult" type="Employee">
        <result property="personID" column="PersonId"/>
        <result property="lastName" column="LastName"/>
        <result property="firstName" column="FirstName"/>
        <result property="city" column="City"/>
        <result property="address" column="Address"/>
        <result property="state" column="State"/>
        <result property="zip" column="Zip"/>
        <result property="telephone" column="Telephone"/>
        <result property="ssn" column="SSN"/>
        <result property="startDate" column="StartDate"/>
        <result property="HourlyRate" column="HourlyRate"/>
        <result property="position" column="Position"/>
        <result property="password" column="Password"/>
    </resultMap>
    
    <resultMap id="customerResult" type="Customer">
        <result property="personID" column="PersonId"/>
        <result property="lastName" column="LastName"/>
        <result property="firstName" column="FirstName"/>
        <result property="city" column="City"/>
        <result property="address" column="Address"/>
        <result property="state" column="State"/>
        <result property="zip" column="Zip"/>
        <result property="telephone" column="Telephone"/>
        <result property="email" column="Email"/>
        <result property="password" column="Password"/>
        <result property="creditCard" column="CreditCard"/>
        <result property="rating" column="Rating"/>
    </resultMap>

    <resultMap id="movieResult" type="Movie">
        <result property="id" column="Id"/>
        <result property="movieType" column="MovieType"/>
        <result property="name" column="Name"/>
        <result property="Fee" column="Fee"/>
        <result property="NumCopes" column="NumCopies"/>
        <result property="rating" column="Rating"/>
        <result property="totalRating" column="TotalRating"/>
    </resultMap>
    
    <resultMap id="accountResult" type="Account">
        <result property="acctNum" column="AcctNum"/>
        <result property="acctType" column="AcctType"/>
        <result property="accountDate" column="AccountDate"/>
        <association property="customer" column="CustomerId" javaType="Customer" select="getCustomerById"/> 
    </resultMap>
    
<!-- ********************************************************************************************* -->

    <select id = "getMail" resultMap = "customerResult" parameterType = "Customer" statementType = "CALLABLE">
	     {call Return_Customer_Mailing_List()}
    </select>


	<insert id = "newCustomer" parameterType = "Customer" statementType = "CALLABLE">
	     {call AddCustomer( 
	     				   #{lastName,javaType=String,jdbcType=CHAR,mode=IN} ,
					       #{firstName,javaType=String,jdbcType=CHAR,mode=IN} ,
					       #{address,javaType=String,jdbcType=CHAR,mode=IN} ,
					       #{city,javaType=String,jdbcType=CHAR,mode=IN} ,
					       #{state,javaType=String,jdbcType=CHAR,mode=IN} ,
					       #{zip,javaType=String,jdbcType=CHAR,mode=IN} ,
					       #{telephone,javaType=String,jdbcType=CHAR,mode=IN} ,
					       #{email,javaType=String,jdbcType=CHAR,mode=IN} ,
					       #{creditCard,javaType=String,jdbcType=CHAR,mode=IN} ,
					       #{password,javaType=String,jdbcType=CHAR,mode=IN}
					       )}
    </insert>
	
	<insert id = "newAccount" parameterType = "Account" statementType = "CALLABLE">
	     {call Add_Account( 
	     				   #{accType,javaType=String,jdbcType=CHAR,mode=IN} ,
	     				   #{accDate,javaType=Date,jdbcType=CHAR,mode=IN},
					       #{customerId,javaType=String,jdbcType=CHAR,mode=IN}  
					       )}
    </insert>

    <select id = "getCustomers" resultMap = "customerResult">
      SELECT *
        FROM Customer
        INNER JOIN Person
        ON Customer.PersonId=Person.PersonId
    </select>
    
    <select id = "getBySSN" resultMap = "employeeResult">
      	SELECT *
        FROM Employee
        INNER JOIN Person
        ON Employee.PersonId=Person.PersonId
		WHERE Employee.SSN = #{SSN}
    </select>

  
    <select id = "getCustomerById" resultMap = "customerResult">
      SELECT *
        FROM Customer
        INNER JOIN Person
        ON Customer.PersonId=Person.PersonId
		WHERE Customer.Email = #{email}
    </select>
    
    <update id="updateCustomer">
    	UPDATE Customer
    	<set>
    	<if test= "customer.password !=null"> Password = #{customer.password},</if>
    	<if test= "customer.creditCard !=null"> CreditCard = #{customer.creditCard}</if>
    	</set>
    	WHERE Email = #{customer.email};
    
	</update>
	
	<update id="updateAccount">
    	UPDATE Account
    	<set>
    	<if test= "account.acctType !=null"> AcctType = #{account.acctType}</if>
    	</set>
    	WHERE CustomerId = #{account.customer.email};
    
	</update>
	
	<update id="updatePerson">
    	UPDATE Person
    	<set>
    	<if test= "customer.firstName !=null"> FirstName = #{customer.firstName},</if>
    	<if test= "customer.lastName !=null"> LastName = #{customer.lastName},</if>
    	<if test= "customer.address !=null"> Address = #{customer.address},</if>
    	<if test= "customer.zip !=null"> Zip = #{customer.zip},</if>
    	<if test= "customer.city !=null"> City = #{customer.telephone},</if>
    	<if test= "customer.state !=null"> State = #{customer.rating},</if>
    	<if test= "customer.telephone != null"> Telephone = #{customer.email}</if>
    	</set>
    	WHERE PersonId = #{customer.personID};
    
	</update>


 </mapper>
